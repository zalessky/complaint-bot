<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —Å–ª—É–∂–±</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        .header { background: #0088cc; color: white; padding: 16px; }
        .kanban { display: flex; gap: 12px; padding: 16px; overflow-x: auto; }
        .column { background: #fff; border-radius: 12px; padding: 12px; min-width: 280px; flex-shrink: 0; }
        .column-title { font-weight: bold; margin-bottom: 12px; }
        .ticket { background: #f8f9fa; border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer; }
        .priority-high { border-left: 4px solid #ff6b6b; }
        .priority-medium { border-left: 4px solid #feca57; }
        .priority-low { border-left: 4px solid #48dbfb; }
    </style>
</head>
<body>
    <div class="header">
        <h2>üé´ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏</h2>
    </div>
    
    <div class="kanban">
        <div class="column">
            <div class="column-title">üì• –ù–æ–≤—ã–µ</div>
            <div id="column-new"></div>
        </div>
        <div class="column">
            <div class="column-title">‚öôÔ∏è –í —Ä–∞–±–æ—Ç–µ</div>
            <div id="column-in_progress"></div>
        </div>
        <div class="column">
            <div class="column-title">‚úÖ –†–µ—à–µ–Ω–æ</div>
            <div id="column-resolved"></div>
        </div>
    </div>
    
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        async function loadTickets() {
            try {
                const initData = tg.initData;
                const response = await fetch('/api/v1/complaints/', {
                    headers: { 'X-Telegram-Init-Data': initData }
                });
                const complaints = await response.json();
                
                ['new', 'in_progress', 'resolved'].forEach(status => {
                    const column = document.getElementById(`column-${status}`);
                    const filtered = complaints.filter(c => c.status === status);
                    if (filtered.length === 0) {
                        column.innerHTML = '<div style="color: #999; font-size: 14px;">–ù–µ—Ç –∑–∞—è–≤–æ–∫</div>';
                    } else {
                        column.innerHTML = filtered.map(c => `
                            <div class="ticket priority-${c.priority}" onclick="openTicket(${c.id})">
                                <div><strong>#${c.id} ${c.category}</strong></div>
                                <div style="font-size: 14px; color: #666; margin-top: 4px;">${c.description.substring(0, 50)}...</div>
                            </div>
                        `).join('');
                    }
                });
            } catch (e) {
                document.getElementById('column-new').innerHTML = '<div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }
        
        function openTicket(id) {
            tg.showAlert(`–û—Ç–∫—Ä—ã—Ç–∏–µ –∑–∞—è–≤–∫–∏ #${id}`);
        }
        
        loadTickets();
    </script>
</body>
</html>
