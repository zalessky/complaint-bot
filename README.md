# Городской Транспорт. Энгельс Telegram Бот

Этот бот предназначен для сбора жалоб на работу общественного транспорта в городе Энгельсе. Разработан на `aiogram 3.x` с использованием `Python 3.12` и `SQLite 3`.

## Функционал

### Пользовательские команды:
*   `/start`, `/help` – Отображает справочную информацию о боте.
*   `/menu` – Выводит основное меню с кнопкой "Подать жалобу".
*   `/complaint` – Запускает мастер подачи жалобы.
*   `/cancel` – Сбрасывает текущее состояние FSM для пользователя.

### Мастер жалобы (`/complaint`):
1.  **Тип нарушения:** Выбор из предопределенного списка.
2.  **Номер маршрута / Гос-номер ТС:** Свободный ввод текста.
3.  **Направление:** Свободный ввод текста.
4.  **Дата-время нарушения:** Выбор "Сейчас" или ручной ввод.
5.  **Загрузка фото/видео:** До 3 файлов (сохраняется только `file_id`).
6.  **Подтверждение:** Проверка данных и сохранение жалобы.

### Админ-команды:
Доступны для пользователей из `ADMINS` в `.env`.
*   `/stats` – Статистика по жалобам.
*   `/last N` – Последние `N` жалоб.
*   `/export` – Экспорт всех жалоб в CSV-файл.
*   `/setstatus <id> <status>` – Изменяет статус жалобы.

## Установка и запуск

### 1. Подготовка

После распаковки проекта, создайте файл `.env` на основе `.env.example` и заполните его:

```ini
BOT_TOKEN=ВАШ_ТОКЕН_БОТА_ИЗ_BOTFATHER
ADMINS=ID_АДМИНА1,ID_АДМИНА2
DB_FILE=complaints.sqlite3
```

### 2. Запуск с помощью Docker Compose (рекомендуемый способ)

Убедитесь, что у вас установлен Docker и Docker Compose. В корневой директории проекта выполните:

```bash
docker compose up --build -d
```

Это соберет образ и запустит контейнеры с ботом и Nginx.

### 3. Запуск локально (для разработки)

Установите [Poetry](https://python-poetry.org/docs/#installation) и зависимости:

```bash
poetry install
```

Запустите бота:

```bash
poetry run python main.py
```

## Тестирование

Для запуска юнит-тестов выполните:

```bash
poetry run pytest
```
